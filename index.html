<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Movie Party - Watch Together</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Custom styles that can't be done with Tailwind */
        .video-container {
            position: relative;
            padding-bottom: 56.25%; /* 16:9 aspect ratio */
            height: 0;
            overflow: hidden;
        }
        .video-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        .chat-messages {
            height: 400px;
            overflow-y: auto;
        }
        .progress-bar {
            height: 5px;
            background-color: #4f46e5;
            width: 0%;
            transition: width 0.1s linear;
        }
    </style>
</head>
<body class="bg-gray-900 text-white">
    <!-- Header -->
    <header class="bg-gray-800 py-4 px-6 flex justify-between items-center">
        <h1 class="text-2xl font-bold text-indigo-500">Movie Party</h1>
        <div class="flex space-x-4">
            <button id="uploadBtn" class="bg-indigo-600 hover:bg-indigo-700 px-4 py-2 rounded">Upload Movie</button>
            <button id="createPartyBtn" class="bg-green-600 hover:bg-green-700 px-4 py-2 rounded">Create Party</button>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
        <!-- Party Section (hidden by default) -->
        <div id="partySection" class="hidden">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- Video Player -->
                <div class="lg:col-span-2">
                    <div class="video-container bg-black rounded-lg">
                        <video id="partyVideo" controls class="w-full">
                            Your browser does not support the video tag.
                        </video>
                    </div>
                    <div class="progress-bar"></div>
                    <div class="flex justify-between items-center mt-2">
                        <span id="currentTime">00:00:00</span>
                        <span id="duration">00:00:00</span>
                    </div>
                    <div class="flex space-x-4 mt-4">
                        <button id="playPauseBtn" class="bg-indigo-600 hover:bg-indigo-700 px-4 py-2 rounded">
                            <i class="fas fa-play"></i> Play
                        </button>
                        <button id="syncBtn" class="bg-yellow-600 hover:bg-yellow-700 px-4 py-2 rounded">
                            <i class="fas fa-sync-alt"></i> Sync
                        </button>
                        <button id="leavePartyBtn" class="bg-red-600 hover:bg-red-700 px-4 py-2 rounded">
                            <i class="fas fa-sign-out-alt"></i> Leave Party
                        </button>
                    </div>
                </div>

                <!-- Chat Section -->
                <div class="bg-gray-800 rounded-lg p-4">
                    <h3 class="text-xl font-semibold mb-4">Party Chat</h3>
                    <div id="chatMessages" class="chat-messages mb-4 space-y-2"></div>
                    <div class="flex">
                        <input id="chatInput" type="text" placeholder="Type your message..." 
                               class="flex-grow bg-gray-700 rounded-l px-4 py-2 focus:outline-none">
                        <button id="sendMessageBtn" class="bg-indigo-600 hover:bg-indigo-700 px-4 py-2 rounded-r">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Party Info -->
            <div id="partyInfo" class="mt-6 bg-gray-800 rounded-lg p-4">
                <h3 class="text-xl font-semibold mb-2">Party Information</h3>
                <p>Party ID: <span id="partyId" class="font-mono">N/A</span></p>
                <p>Members: <span id="partyMembers">1</span></p>
                <p>Movie: <span id="partyMovie">None</span></p>
                <div class="mt-2">
                    <label for="inviteLink" class="block text-sm font-medium">Invite Link:</label>
                    <div class="flex">
                        <input id="inviteLink" type="text" readonly 
                               class="flex-grow bg-gray-700 rounded-l px-4 py-2 focus:outline-none">
                        <button id="copyInviteBtn" class="bg-indigo-600 hover:bg-indigo-700 px-4 py-2 rounded-r">
                            <i class="fas fa-copy"></i> Copy
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Join Party Modal -->
        <div id="joinPartyModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden">
            <div class="bg-gray-800 rounded-lg p-6 w-full max-w-md">
                <h3 class="text-xl font-semibold mb-4">Join a Party</h3>
                <div class="mb-4">
                    <label for="partyCode" class="block text-sm font-medium mb-2">Party Code:</label>
                    <input id="partyCode" type="text" placeholder="Enter party code" 
                           class="w-full bg-gray-700 rounded px-4 py-2 focus:outline-none">
                </div>
                <div class="flex justify-end space-x-2">
                    <button id="cancelJoinBtn" class="bg-gray-600 hover:bg-gray-700 px-4 py-2 rounded">Cancel</button>
                    <button id="confirmJoinBtn" class="bg-indigo-600 hover:bg-indigo-700 px-4 py-2 rounded">Join</button>
                </div>
            </div>
        </div>

        <!-- Create Party Modal -->
        <div id="createPartyModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden">
            <div class="bg-gray-800 rounded-lg p-6 w-full max-w-md">
                <h3 class="text-xl font-semibold mb-4">Create a Party</h3>
                <div class="mb-4">
                    <label for="partyName" class="block text-sm font-medium mb-2">Party Name:</label>
                    <input id="partyName" type="text" placeholder="My Awesome Party" 
                           class="w-full bg-gray-700 rounded px-4 py-2 focus:outline-none">
                </div>
                <div class="mb-4">
                    <label for="selectMovie" class="block text-sm font-medium mb-2">Select Movie:</label>
                    <select id="selectMovie" class="w-full bg-gray-700 rounded px-4 py-2 focus:outline-none">
                        <option value="">Select a movie</option>
                    </select>
                </div>
                <div class="flex justify-end space-x-2">
                    <button id="cancelCreateBtn" class="bg-gray-600 hover:bg-gray-700 px-4 py-2 rounded">Cancel</button>
                    <button id="confirmCreateBtn" class="bg-green-600 hover:bg-green-700 px-4 py-2 rounded">Create</button>
                </div>
            </div>
        </div>

        <!-- Upload Movie Modal -->
        <div id="uploadModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden">
            <div class="bg-gray-800 rounded-lg p-6 w-full max-w-md">
                <h3 class="text-xl font-semibold mb-4">Upload a Movie</h3>
                <div class="mb-4">
                    <label for="movieTitle" class="block text-sm font-medium mb-2">Movie Title:</label>
                    <input id="movieTitle" type="text" placeholder="Movie title" 
                           class="w-full bg-gray-700 rounded px-4 py-2 focus:outline-none">
                </div>
                <div class="mb-4">
                    <label for="movieFile" class="block text-sm font-medium mb-2">Movie File:</label>
                    <input id="movieFile" type="file" accept="video/*" 
                           class="w-full bg-gray-700 rounded px-4 py-2 focus:outline-none">
                </div>
                <div class="mb-4">
                    <label for="movieThumbnail" class="block text-sm font-medium mb-2">Thumbnail (optional):</label>
                    <input id="movieThumbnail" type="file" accept="image/*" 
                           class="w-full bg-gray-700 rounded px-4 py-2 focus:outline-none">
                </div>
                <div class="flex justify-end space-x-2">
                    <button id="cancelUploadBtn" class="bg-gray-600 hover:bg-gray-700 px-4 py-2 rounded">Cancel</button>
                    <button id="confirmUploadBtn" class="bg-indigo-600 hover:bg-indigo-700 px-4 py-2 rounded">Upload</button>
                </div>
            </div>
        </div>

        <!-- Home Content (shown when not in a party) -->
        <div id="homeContent" class="text-center py-12">
            <h2 class="text-3xl font-bold mb-6">Watch Movies Together in Sync</h2>
            <p class="text-xl mb-8">Create or join a watch party to enjoy movies with friends in real-time.</p>
            <div class="flex justify-center space-x-4">
                <button id="joinPartyBtn" class="bg-indigo-600 hover:bg-indigo-700 px-6 py-3 rounded-lg text-lg">
                    <i class="fas fa-user-plus mr-2"></i> Join Party
                </button>
                <button id="createPartyBtn2" class="bg-green-600 hover:bg-green-700 px-6 py-3 rounded-lg text-lg">
                    <i class="fas fa-plus mr-2"></i> Create Party
                </button>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 py-6 px-6 text-center">
        <p>Â© 2023 Movie Party. All rights reserved.</p>
    </footer>

    <script>
        // DOM Elements
const LOCAL_STORAGE_KEYS = {
            MOVIES: 'movies',
            CURRENT_PARTY: 'currentParty'
        };

        // DOM Elements
        const elements = {
            partySection: document.getElementById('partySection'),
            homeContent: document.getElementById('homeContent'),
            joinPartyModal: document.getElementById('joinPartyModal'),
            createPartyModal: document.getElementById('createPartyModal'),
            uploadModal: document.getElementById('uploadModal'),
            partyVideo: document.getElementById('partyVideo'),
            chatMessages: document.getElementById('chatMessages'),
            chatInput: document.getElementById('chatInput'),
            sendMessageBtn: document.getElementById('sendMessageBtn'),
            playPauseBtn: document.getElementById('playPauseBtn'),
            syncBtn: document.getElementById('syncBtn'),
            leavePartyBtn: document.getElementById('leavePartyBtn'),
            currentTime: document.getElementById('currentTime'),
            duration: document.getElementById('duration'),
            partyId: document.getElementById('partyId'),
            partyMembers: document.getElementById('partyMembers'),
            partyMovie: document.getElementById('partyMovie'),
            inviteLink: document.getElementById('inviteLink'),
            copyInviteBtn: document.getElementById('copyInviteBtn'),
            progressBar: document.querySelector('.progress-bar'),
            uploadBtn: document.getElementById('uploadBtn'),
            createPartyBtn: document.getElementById('createPartyBtn'),
            createPartyBtn2: document.getElementById('createPartyBtn2'),
            joinPartyBtn: document.getElementById('joinPartyBtn'),
            cancelJoinBtn: document.getElementById('cancelJoinBtn'),
            confirmJoinBtn: document.getElementById('confirmJoinBtn'),
            cancelCreateBtn: document.getElementById('cancelCreateBtn'),
            confirmCreateBtn: document.getElementById('confirmCreateBtn'),
            cancelUploadBtn: document.getElementById('cancelUploadBtn'),
            confirmUploadBtn: document.getElementById('confirmUploadBtn'),
            partyCode: document.getElementById('partyCode'),
            partyName: document.getElementById('partyName'),
            selectMovie: document.getElementById('selectMovie'),
            movieTitle: document.getElementById('movieTitle'),
            movieFile: document.getElementById('movieFile'),
            movieThumbnail: document.getElementById('movieThumbnail')
        };

        // State
        const state = {
            currentParty: null,
            isHost: false,
            members: [],
            movies: [],
            socket: null,
            videoInterval: null,
            mockMovies: [
                { 
                    id: '1', 
                    title: 'Inception', 
                    url: 'https://example.com/videos/inception.mp4', 
                    thumbnail: 'https://example.com/thumbnails/inception.jpg' 
                },
                { 
                    id: '2', 
                    title: 'The Shawshank Redemption', 
                    url: 'https://example.com/videos/shawshank.mp4', 
                    thumbnail: 'https://example.com/thumbnails/shawshank.jpg' 
                },
                { 
                    id: '3', 
                    title: 'Pulp Fiction', 
                    url: 'https://example.com/videos/pulp.mp4', 
                    thumbnail: 'https://example.com/thumbnails/pulp.jpg' 
                }
            ],
            mockMessages: [
                { type: 'chat', user: 'Friend1', message: 'This movie is awesome!' },
                { type: 'chat', user: 'Friend2', message: 'I love this scene!' },
                { type: 'sync', time: 0 }
            ]
        };

        // Utility functions
        const utils = {
            formatTime: (seconds) => {
                const h = Math.floor(seconds / 3600);
                const m = Math.floor((seconds % 3600) / 60);
                const s = Math.floor(seconds % 60);
                return [h, m, s].map(unit => unit.toString().padStart(2, '0')).join(':');
            },
            generateId: (prefix = '') => {
                return `${prefix}${Math.random().toString(36).substr(2, 8)}`;
            },
            toggleModal: (modal, show) => {
                modal.classList.toggle('hidden', !show);
            },
            clearForm: (form) => {
                if (form.tagName === 'FORM') {
                    form.reset();
                } else if (form instanceof HTMLInputElement || form instanceof HTMLSelectElement) {
                    form.value = '';
                }
            }
        };

        // Movie functions
        const movieManager = {
            loadMovies: () => {
                const storedMovies = localStorage.getItem(LOCAL_STORAGE_KEYS.MOVIES);
                state.movies = storedMovies ? JSON.parse(storedMovies) : state.mockMovies;
                movieManager.updateMovieSelect();
            },
            updateMovieSelect: () => {
                elements.selectMovie.innerHTML = '<option value="">Select a movie</option>';
                state.movies.forEach(movie => {
                    const option = document.createElement('option');
                    option.value = movie.id;
                    option.textContent = movie.title;
                    elements.selectMovie.appendChild(option);
                });
            },
            uploadMovie: () => {
                const title = elements.movieTitle.value.trim();
                const file = elements.movieFile.files[0];
                
                if (!title || !file) {
                    alert(title ? 'Please select a movie file' : 'Please enter a movie title');
                    return false;
                }
                
                const newMovie = {
                    id: utils.generateId('movie-'),
                    title: title,
                    url: URL.createObjectURL(file),
                    thumbnail: elements.movieThumbnail.files[0] ? 
                            URL.createObjectURL(elements.movieThumbnail.files[0]) : ''
                };
                
                state.movies.push(newMovie);
                localStorage.setItem(LOCAL_STORAGE_KEYS.MOVIES, JSON.stringify(state.movies));
                movieManager.updateMovieSelect();
                
                utils.clearForm(elements.movieTitle);
                utils.clearForm(elements.movieFile);
                utils.clearForm(elements.movieThumbnail);
                
                return true;
            }
        };

        // Party functions
        const partyManager = {
            joinParty: (party) => {
                state.currentParty = party;
                state.isHost = party.isHost || false;
                state.members = party.members || [];
                
                localStorage.setItem(LOCAL_STORAGE_KEYS.CURRENT_PARTY, JSON.stringify(party));
                
                // Update UI
                elements.partySection.classList.remove('hidden');
                elements.homeContent.classList.add('hidden');
                
                elements.partyId.textContent = party.id;
                elements.partyMembers.textContent = state.members.length;
                elements.partyMovie.textContent = party.movie.title;
                
                // Set up video
                elements.partyVideo.src = party.movie.url;
                elements.partyVideo.load();
                
                // Set invite link
                elements.inviteLink.value = `${window.location.origin}?party=${party.id}`;
                
                // Connect to WebSocket
                partyManager.connectWebSocket();
                
                // Start video sync
                partyManager.startVideoSync();
            },
            createParty: (name, movieId) => {
                const selectedMovie = state.movies.find(m => m.id === movieId);
                if (!selectedMovie) return false;
                
                const newParty = {
                    id: utils.generateId('party-'),
                    name: name,
                    movie: selectedMovie,
                    members: [{ id: 'user1', name: 'You (Host)' }],
                    isHost: true
                };
                
                partyManager.joinParty(newParty);
                return true;
            },
            connectWebSocket: () => {
                // Mock WebSocket for demo
                state.socket = {
                    send: (data) => console.log('WebSocket send:', data),
                    close: () => console.log('WebSocket closed')
                };
                
                // Simulate receiving messages
                setInterval(() => {
                    if (Math.random() > 0.7) {
                        const randomMessage = {
                            ...state.mockMessages[Math.floor(Math.random() * state.mockMessages.length)]
                        };
                        if (randomMessage.type === 'sync') {
                            randomMessage.time = elements.partyVideo.currentTime + 0.5;
                        }
                        partyManager.handleSocketMessage({ data: JSON.stringify(randomMessage) });
                    }
                }, 5000);
            },
            handleSocketMessage: (event) => {
                const data = JSON.parse(event.data);
                
                switch (data.type) {
                    case 'chat':
                        chatManager.addMessage(data.user, data.message);
                        break;
                    case 'sync':
                        if (!state.isHost) {
                            elements.partyVideo.currentTime = data.time;
                        }
                        break;
                    case 'play':
                        if (!state.isHost) {
                            elements.partyVideo.play();
                        }
                        break;
                    case 'pause':
                        if (!state.isHost) {
                            elements.partyVideo.pause();
                        }
                        break;
                    case 'members':
                        state.members = data.members;
                        elements.partyMembers.textContent = state.members.length;
                        break;
                }
            },
            startVideoSync: () => {
                if (state.videoInterval) clearInterval(state.videoInterval);
                
                state.videoInterval = setInterval(() => {
                    if (state.isHost && elements.partyVideo.readyState > 0) {
                        state.socket.send(JSON.stringify({
                            type: 'sync',
                            time: elements.partyVideo.currentTime
                        }));
                    }
                }, 1000);
            },
            leaveParty: () => {
                if (confirm('Are you sure you want to leave the party?')) {
                    if (state.socket) state.socket.close();
                    if (state.videoInterval) clearInterval(state.videoInterval);
                    
                    elements.partyVideo.pause();
                    elements.partyVideo.src = '';
                    
                    state.currentParty = null;
                    state.isHost = false;
                    state.members = [];
                    
                    localStorage.removeItem(LOCAL_STORAGE_KEYS.CURRENT_PARTY);
                    
                    elements.partySection.classList.add('hidden');
                    elements.homeContent.classList.remove('hidden');
                    elements.chatMessages.innerHTML = '';
                }
            }
        };

        // Chat functions
        const chatManager = {
            addMessage: (user, message) => {
                const messageElement = document.createElement('div');
                messageElement.className = 'bg-gray-700 p-2 rounded';
                messageElement.innerHTML = `<strong class="text-indigo-400">${user}:</strong> ${message}`;
                elements.chatMessages.appendChild(messageElement);
                elements.chatMessages.scrollTop = elements.chatMessages.scrollHeight;
            },
            sendMessage: () => {
                const message = elements.chatInput.value.trim();
                if (!message) return;
                
                state.socket.send(JSON.stringify({
                    type: 'chat',
                    user: 'You',
                    message: message
                }));
                
                chatManager.addMessage('You', message);
                elements.chatInput.value = '';
            }
        };

        // Video functions
        const videoManager = {
            togglePlayPause: () => {
                if (elements.partyVideo.paused) {
                    elements.partyVideo.play();
                    if (state.isHost) {
                        state.socket.send(JSON.stringify({ type: 'play' }));
                    }
                } else {
                    elements.partyVideo.pause();
                    if (state.isHost) {
                        state.socket.send(JSON.stringify({ type: 'pause' }));
                    }
                }
            },
            syncVideo: () => {
                if (!state.isHost) {
                    state.socket.send(JSON.stringify({ type: 'requestSync' }));
                    alert('Video synced with host');
                } else {
                    alert('You are the host, others will sync with you');
                }
            },
            handleVideoPlay: () => {
                elements.playPauseBtn.innerHTML = '<i class="fas fa-pause"></i> Pause';
            },
            handleVideoPause: () => {
                elements.playPauseBtn.innerHTML = '<i class="fas fa-play"></i> Play';
            },
            updateVideoProgress: () => {
                const percent = (elements.partyVideo.currentTime / elements.partyVideo.duration) * 100;
                elements.progressBar.style.width = `${percent}%`;
                elements.currentTime.textContent = utils.formatTime(elements.partyVideo.currentTime);
            },
            updateVideoDuration: () => {
                elements.duration.textContent = utils.formatTime(elements.partyVideo.duration);
            }
        };

        // Event handlers
        const eventHandlers = {
            handleJoinParty: () => {
                const code = elements.partyCode.value.trim();
                if (!code) {
                    alert('Please enter a party code');
                    return;
                }
                
                const mockParty = {
                    id: code,
                    name: "Demo Party",
                    movie: state.movies[0],
                    members: [{ id: 'user1', name: 'You' }]
                };
                
                partyManager.joinParty(mockParty);
                utils.toggleModal(elements.joinPartyModal, false);
                utils.clearForm(elements.partyCode);
            },
            handleCreateParty: () => {
                const name = elements.partyName.value.trim();
                const movieId = elements.selectMovie.value;
                
                if (!name || !movieId) {
                    alert(name ? 'Please select a movie' : 'Please enter a party name');
                    return;
                }
                
                if (partyManager.createParty(name, movieId)) {
                    utils.toggleModal(elements.createPartyModal, false);
                    utils.clearForm(elements.partyName);
                    utils.clearForm(elements.selectMovie);
                }
            },
            handleUploadMovie: () => {
                if (movieManager.uploadMovie()) {
                    utils.toggleModal(elements.uploadModal, false);
                    alert('Movie uploaded successfully!');
                }
            },
            copyInviteLink: () => {
                elements.inviteLink.select();
                document.execCommand('copy');
                alert('Invite link copied to clipboard!');
            }
        };

        // Initialize event listeners
        const initEventListeners = () => {
            // Modal buttons
            elements.uploadBtn.addEventListener('click', () => utils.toggleModal(elements.uploadModal, true));
            elements.createPartyBtn.addEventListener('click', () => utils.toggleModal(elements.createPartyModal, true));
            elements.createPartyBtn2.addEventListener('click', () => utils.toggleModal(elements.createPartyModal, true));
            elements.joinPartyBtn.addEventListener('click', () => utils.toggleModal(elements.joinPartyModal, true));
            
            // Modal actions
            elements.cancelJoinBtn.addEventListener('click', () => utils.toggleModal(elements.joinPartyModal, false));
            elements.confirmJoinBtn.addEventListener('click', eventHandlers.handleJoinParty);
            elements.cancelCreateBtn.addEventListener('click', () => utils.toggleModal(elements.createPartyModal, false));
            elements.confirmCreateBtn.addEventListener('click', eventHandlers.handleCreateParty);
            elements.cancelUploadBtn.addEventListener('click', () => utils.toggleModal(elements.uploadModal, false));
            elements.confirmUploadBtn.addEventListener('click', eventHandlers.handleUploadMovie);
            
            // Party controls
            elements.playPauseBtn.addEventListener('click', videoManager.togglePlayPause);
            elements.syncBtn.addEventListener('click', videoManager.syncVideo);
            elements.leavePartyBtn.addEventListener('click', partyManager.leaveParty);
            elements.copyInviteBtn.addEventListener('click', eventHandlers.copyInviteLink);
            
            // Chat
            elements.sendMessageBtn.addEventListener('click', chatManager.sendMessage);
            elements.chatInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') chatManager.sendMessage();
            });
            
            // Video events
            elements.partyVideo.addEventListener('play', videoManager.handleVideoPlay);
            elements.partyVideo.addEventListener('pause', videoManager.handleVideoPause);
            elements.partyVideo.addEventListener('timeupdate', videoManager.updateVideoProgress);
            elements.partyVideo.addEventListener('loadedmetadata', videoManager.updateVideoDuration);
        };

        // Initialize the app
        const init = () => {
            movieManager.loadMovies();
            
            // Check if rejoining a party
            const storedParty = localStorage.getItem(LOCAL_STORAGE_KEYS.CURRENT_PARTY);
            if (storedParty) {
                partyManager.joinParty(JSON.parse(storedParty));
            }
            
            initEventListeners();
        };

        // Start the app
        document.addEventListener('DOMContentLoaded', init);
    </script>
   
</body>
</html>




http://127.0.0.1:5500?